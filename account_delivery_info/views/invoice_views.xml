<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <record id="view_move_form_delivery" model="ir.ui.view">
    <field name="name">account_move_form_delivery</field>
    <field name="model">account.move</field>
    <field name="inherit_id" ref="account.view_move_form" />
    <field name="arch" type="xml">
      <xpath expr="//page[@id='other_tab']" position="after">
        <page id="delivery_tab" string="Deliveries" groups="base.group_no_one">
          <field name="delivery_ids" />
        </page>
      </xpath>
    </field>
  </record>
  <template id="report_invoice_document_delivery" inherit_id="account.report_invoice_document">
    <data inherit_id="account.report_invoice_document">
      <xpath expr="//p[@name='note']" position="after">
        <t t-foreach="o.delivery_ids" t-as="delivery">
          <t t-if="delivery.state == 'done'">
            <span>Delivery:</span>
            <strong>
              <span t-field="delivery.name" />
            </strong>
            <span>at date:</span>
            <strong>
              <span t-esc="delivery.date_done" t-options="{&quot;widget&quot;: &quot;date&quot;}" />
            </strong>
            <span>from:</span>
            <strong>
              <span t-field="delivery.company_id.name" />
              <t t-if="delivery.company_id.name != delivery.picking_type_id.warehouse_id.name">
                <span>/</span>
                <span t-field="delivery.picking_type_id.warehouse_id.name" />
              </t>
            </strong>
          </t>
        </t>
      </xpath>
    </data>
  </template>
</odoo>
